-- generated sp 73: tier=medium flags=[noformatting,nocaps]
-- expect  sources:[etl].[errorlog],[dbo].[account]  targets:[ops].[picklist],[etl].[loadlog]  exec:[dbo].[usp_updatecustomer],[audit].[usp_logaccess]

create procedure [hr].[usp_genmedium_073] @batchid    int = 0, @processdate datetime = null as begin set nocount on; if @processdate is null set @processdate = getdate(); declare @rowcount int = 0; declare @starttime datetime = getutcdate(); insert into [ops].[picklist] ([sourceid], [sourcename], [loadedat]) select s.[id], s.[name], getutcdate() from   etl.errorlog as s where  s.[isdeleted] = 0; set @rowcount = @rowcount + @@rowcount; insert into [etl].[loadlog] ([sourceid], [refid], [amount], [loadedat]) select a.[id]          as sourceid, b.[id]          as refid, isnull(a.[amount], 0) as amount, getutcdate()    as loadedat from   etl.errorlog as a join   [dbo].[account] as c on c.[id] = a.[id] where  a.[status] = n'pending'; set @rowcount = @rowcount + @@rowcount; update t set    t.[status]      = s.[status], t.[updateddate] = getutcdate() from   [ops].[picklist] as t join   [dbo].[account] as s on s.[id] = t.[sourceid] where  t.[status] = n'pending'; set @rowcount = @rowcount + @@rowcount; exec dbo.usp_updatecustomer @processdate = getdate(), @batchid = @batchid; exec [audit].[usp_logaccess] @processdate = getdate(), @batchid = @batchid; select @rowcount = count(*) from etl.errorlog where [isdeleted] = 0; select @rowcount = count(*) from dbo.account where [isdeleted] = 0; return @rowcount; end go